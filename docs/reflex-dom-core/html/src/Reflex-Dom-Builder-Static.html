<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>src/Reflex/Dom/Builder/Static.hs</title>
<link type='text/css' rel='stylesheet' href='hscolour.css' />
</head>
<body>
<pre><a name="line-1"></a><span class='hs-comment'>{-# LANGUAGE ConstraintKinds #-}</span>
<a name="line-2"></a><span class='hs-comment'>{-# LANGUAGE DataKinds #-}</span>
<a name="line-3"></a><span class='hs-comment'>{-# LANGUAGE DeriveGeneric #-}</span>
<a name="line-4"></a><span class='hs-comment'>{-# LANGUAGE EmptyDataDecls #-}</span>
<a name="line-5"></a><span class='hs-comment'>{-# LANGUAGE FlexibleContexts #-}</span>
<a name="line-6"></a><span class='hs-comment'>{-# LANGUAGE FlexibleInstances #-}</span>
<a name="line-7"></a><span class='hs-comment'>{-# LANGUAGE GeneralizedNewtypeDeriving #-}</span>
<a name="line-8"></a><span class='hs-comment'>{-# LANGUAGE MultiParamTypeClasses #-}</span>
<a name="line-9"></a><span class='hs-comment'>{-# LANGUAGE OverloadedStrings #-}</span>
<a name="line-10"></a><span class='hs-comment'>{-# LANGUAGE PolyKinds #-}</span>
<a name="line-11"></a><span class='hs-comment'>{-# LANGUAGE RankNTypes #-}</span>
<a name="line-12"></a><span class='hs-comment'>{-# LANGUAGE ScopedTypeVariables #-}</span>
<a name="line-13"></a><span class='hs-comment'>{-# LANGUAGE TypeFamilies #-}</span>
<a name="line-14"></a><span class='hs-comment'>{-# LANGUAGE TypeOperators #-}</span>
<a name="line-15"></a><span class='hs-comment'>{-# LANGUAGE UndecidableInstances #-}</span>
<a name="line-16"></a><span class='hs-keyword'>module</span> <span class='hs-conid'>Reflex</span><span class='hs-varop'>.</span><span class='hs-conid'>Dom</span><span class='hs-varop'>.</span><span class='hs-conid'>Builder</span><span class='hs-varop'>.</span><span class='hs-conid'>Static</span> <span class='hs-keyword'>where</span>
<a name="line-17"></a>
<a name="line-18"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Blaze</span><span class='hs-varop'>.</span><span class='hs-conid'>ByteString</span><span class='hs-varop'>.</span><span class='hs-conid'>Builder</span><span class='hs-varop'>.</span><span class='hs-conid'>Html</span><span class='hs-varop'>.</span><span class='hs-conid'>Utf8</span>
<a name="line-19"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Control</span><span class='hs-varop'>.</span><span class='hs-conid'>Lens</span> <span class='hs-varid'>hiding</span> <span class='hs-layout'>(</span><span class='hs-varid'>element</span><span class='hs-layout'>)</span>
<a name="line-20"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Control</span><span class='hs-varop'>.</span><span class='hs-conid'>Monad</span><span class='hs-varop'>.</span><span class='hs-conid'>Exception</span>
<a name="line-21"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Control</span><span class='hs-varop'>.</span><span class='hs-conid'>Monad</span><span class='hs-varop'>.</span><span class='hs-conid'>Identity</span>
<a name="line-22"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Control</span><span class='hs-varop'>.</span><span class='hs-conid'>Monad</span><span class='hs-varop'>.</span><span class='hs-conid'>Primitive</span>
<a name="line-23"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Control</span><span class='hs-varop'>.</span><span class='hs-conid'>Monad</span><span class='hs-varop'>.</span><span class='hs-conid'>Ref</span>
<a name="line-24"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Control</span><span class='hs-varop'>.</span><span class='hs-conid'>Monad</span><span class='hs-varop'>.</span><span class='hs-conid'>State</span><span class='hs-varop'>.</span><span class='hs-conid'>Strict</span>
<a name="line-25"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Control</span><span class='hs-varop'>.</span><span class='hs-conid'>Monad</span><span class='hs-varop'>.</span><span class='hs-conid'>Trans</span><span class='hs-varop'>.</span><span class='hs-conid'>Reader</span>
<a name="line-26"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>ByteString</span> <span class='hs-layout'>(</span><span class='hs-conid'>ByteString</span><span class='hs-layout'>)</span>
<a name="line-27"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>ByteString</span><span class='hs-varop'>.</span><span class='hs-conid'>Builder</span> <span class='hs-layout'>(</span><span class='hs-conid'>Builder</span><span class='hs-layout'>,</span> <span class='hs-varid'>byteString</span><span class='hs-layout'>,</span> <span class='hs-varid'>toLazyByteString</span><span class='hs-layout'>)</span>
<a name="line-28"></a><span class='hs-keyword'>import</span> <span class='hs-keyword'>qualified</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>ByteString</span><span class='hs-varop'>.</span><span class='hs-conid'>Lazy</span> <span class='hs-keyword'>as</span> <span class='hs-conid'>LBS</span>
<a name="line-29"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Default</span>
<a name="line-30"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Dependent</span><span class='hs-varop'>.</span><span class='hs-conid'>Map</span> <span class='hs-layout'>(</span><span class='hs-conid'>DMap</span><span class='hs-layout'>)</span>
<a name="line-31"></a><span class='hs-keyword'>import</span> <span class='hs-keyword'>qualified</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Dependent</span><span class='hs-varop'>.</span><span class='hs-conid'>Map</span> <span class='hs-keyword'>as</span> <span class='hs-conid'>DMap</span>
<a name="line-32"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Dependent</span><span class='hs-varop'>.</span><span class='hs-conid'>Sum</span> <span class='hs-layout'>(</span><span class='hs-conid'>DSum</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-33"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Functor</span><span class='hs-varop'>.</span><span class='hs-conid'>Compose</span>
<a name="line-34"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Functor</span><span class='hs-varop'>.</span><span class='hs-conid'>Constant</span>
<a name="line-35"></a><span class='hs-keyword'>import</span> <span class='hs-keyword'>qualified</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Map</span> <span class='hs-keyword'>as</span> <span class='hs-conid'>Map</span>
<a name="line-36"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Map</span><span class='hs-varop'>.</span><span class='hs-conid'>Misc</span> <span class='hs-layout'>(</span><span class='hs-varid'>applyMap</span><span class='hs-layout'>)</span>
<a name="line-37"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Monoid</span>
<a name="line-38"></a><span class='hs-keyword'>import</span> <span class='hs-keyword'>qualified</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Set</span> <span class='hs-keyword'>as</span> <span class='hs-conid'>Set</span>
<a name="line-39"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Text</span> <span class='hs-layout'>(</span><span class='hs-conid'>Text</span><span class='hs-layout'>)</span>
<a name="line-40"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Text</span><span class='hs-varop'>.</span><span class='hs-conid'>Encoding</span>
<a name="line-41"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Tuple</span>
<a name="line-42"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>GHC</span><span class='hs-varop'>.</span><span class='hs-conid'>Generics</span>
<a name="line-43"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Reflex</span><span class='hs-varop'>.</span><span class='hs-conid'>Class</span>
<a name="line-44"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Reflex</span><span class='hs-varop'>.</span><span class='hs-conid'>Dom</span><span class='hs-varop'>.</span><span class='hs-conid'>Builder</span><span class='hs-varop'>.</span><span class='hs-conid'>Class</span>
<a name="line-45"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Reflex</span><span class='hs-varop'>.</span><span class='hs-conid'>Dynamic</span>
<a name="line-46"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Reflex</span><span class='hs-varop'>.</span><span class='hs-conid'>Host</span><span class='hs-varop'>.</span><span class='hs-conid'>Class</span>
<a name="line-47"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Reflex</span><span class='hs-varop'>.</span><span class='hs-conid'>PerformEvent</span><span class='hs-varop'>.</span><span class='hs-conid'>Base</span>
<a name="line-48"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Reflex</span><span class='hs-varop'>.</span><span class='hs-conid'>PerformEvent</span><span class='hs-varop'>.</span><span class='hs-conid'>Class</span>
<a name="line-49"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Reflex</span><span class='hs-varop'>.</span><span class='hs-conid'>PostBuild</span><span class='hs-varop'>.</span><span class='hs-conid'>Base</span>
<a name="line-50"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Reflex</span><span class='hs-varop'>.</span><span class='hs-conid'>Spider</span>
<a name="line-51"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Reflex</span><span class='hs-varop'>.</span><span class='hs-conid'>TriggerEvent</span><span class='hs-varop'>.</span><span class='hs-conid'>Class</span>
<a name="line-52"></a>
<a name="line-53"></a><a name="StaticDomBuilderEnv"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>StaticDomBuilderEnv</span> <span class='hs-varid'>t</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>StaticDomBuilderEnv</span>
<a name="line-54"></a>  <span class='hs-layout'>{</span> <span class='hs-sel'>_staticDomBuilderEnv_shouldEscape</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Bool</span>
<a name="line-55"></a>  <span class='hs-layout'>,</span> <span class='hs-sel'>_staticDomBuilderEnv_selectValue</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>Behavior</span> <span class='hs-varid'>t</span> <span class='hs-conid'>Text</span><span class='hs-layout'>)</span>
<a name="line-56"></a>    <span class='hs-comment'>-- ^ When the parent element is a "select" whose value has been set, this value tells us the current value.</span>
<a name="line-57"></a>    <span class='hs-comment'>-- We use this to add a "selected" attribute to the appropriate "option" child element.</span>
<a name="line-58"></a>    <span class='hs-comment'>-- This is not yet a perfect simulation of what the browser does, but it is much closer than doing nothing.</span>
<a name="line-59"></a>    <span class='hs-comment'>-- TODO: Handle edge cases, e.g. setting to a value for which there is no option, then adding that option dynamically afterwards.</span>
<a name="line-60"></a>  <span class='hs-layout'>}</span>
<a name="line-61"></a>
<a name="line-62"></a><a name="StaticDomBuilderT"></a><span class='hs-keyword'>newtype</span> <span class='hs-conid'>StaticDomBuilderT</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>StaticDomBuilderT</span>
<a name="line-63"></a>    <span class='hs-layout'>{</span> <span class='hs-varid'>unStaticDomBuilderT</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ReaderT</span> <span class='hs-layout'>(</span><span class='hs-conid'>StaticDomBuilderEnv</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>StateT</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Behavior</span> <span class='hs-varid'>t</span> <span class='hs-conid'>Builder</span><span class='hs-keyglyph'>]</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-varid'>a</span> <span class='hs-comment'>-- Accumulated Html will be in reversed order</span>
<a name="line-64"></a>    <span class='hs-layout'>}</span>
<a name="line-65"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Functor</span><span class='hs-layout'>,</span> <span class='hs-conid'>Applicative</span><span class='hs-layout'>,</span> <span class='hs-conid'>Monad</span><span class='hs-layout'>,</span> <span class='hs-conid'>MonadFix</span><span class='hs-layout'>,</span> <span class='hs-conid'>MonadIO</span><span class='hs-layout'>,</span> <span class='hs-conid'>MonadException</span><span class='hs-layout'>,</span> <span class='hs-conid'>MonadAsyncException</span><span class='hs-layout'>)</span>
<a name="line-66"></a>
<a name="line-67"></a><a name="instance%20PrimMonad%20(StaticDomBuilderT%20x%20m)"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>PrimMonad</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>PrimMonad</span> <span class='hs-layout'>(</span><span class='hs-conid'>StaticDomBuilderT</span> <span class='hs-varid'>x</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-68"></a>  <span class='hs-keyword'>type</span> <span class='hs-conid'>PrimState</span> <span class='hs-layout'>(</span><span class='hs-conid'>StaticDomBuilderT</span> <span class='hs-varid'>x</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>PrimState</span> <span class='hs-varid'>m</span>
<a name="line-69"></a>  <span class='hs-varid'>primitive</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>lift</span> <span class='hs-varop'>.</span> <span class='hs-varid'>primitive</span>
<a name="line-70"></a>
<a name="line-71"></a><a name="instance%20MonadTrans%20(StaticDomBuilderT%20t)"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>MonadTrans</span> <span class='hs-layout'>(</span><span class='hs-conid'>StaticDomBuilderT</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-72"></a>  <span class='hs-varid'>lift</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>StaticDomBuilderT</span> <span class='hs-varop'>.</span> <span class='hs-varid'>lift</span> <span class='hs-varop'>.</span> <span class='hs-varid'>lift</span>
<a name="line-73"></a>
<a name="line-74"></a><a name="runStaticDomBuilderT"></a><span class='hs-definition'>runStaticDomBuilderT</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Monad</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>Reflex</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>StaticDomBuilderT</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>StaticDomBuilderEnv</span> <span class='hs-varid'>t</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-conid'>Behavior</span> <span class='hs-varid'>t</span> <span class='hs-conid'>Builder</span><span class='hs-layout'>)</span>
<a name="line-75"></a><span class='hs-definition'>runStaticDomBuilderT</span> <span class='hs-layout'>(</span><span class='hs-conid'>StaticDomBuilderT</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-varid'>e</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-76"></a>  <span class='hs-layout'>(</span><span class='hs-varid'>result</span><span class='hs-layout'>,</span> <span class='hs-varid'>a'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>runStateT</span> <span class='hs-layout'>(</span><span class='hs-varid'>runReaderT</span> <span class='hs-varid'>a</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-conid'>[]</span>
<a name="line-77"></a>  <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>result</span><span class='hs-layout'>,</span> <span class='hs-varid'>mconcat</span> <span class='hs-varop'>$</span> <span class='hs-varid'>reverse</span> <span class='hs-varid'>a'</span><span class='hs-layout'>)</span>
<a name="line-78"></a>
<a name="line-79"></a><a name="instance%20MonadReflexCreateTrigger%20t%20(StaticDomBuilderT%20t%20m)"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>MonadReflexCreateTrigger</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>MonadReflexCreateTrigger</span> <span class='hs-varid'>t</span> <span class='hs-layout'>(</span><span class='hs-conid'>StaticDomBuilderT</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-80"></a>  <span class='hs-comment'>{-# INLINABLE newEventWithTrigger #-}</span>
<a name="line-81"></a>  <span class='hs-varid'>newEventWithTrigger</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>lift</span> <span class='hs-varop'>.</span> <span class='hs-varid'>newEventWithTrigger</span>
<a name="line-82"></a>  <span class='hs-comment'>{-# INLINABLE newFanEventWithTrigger #-}</span>
<a name="line-83"></a>  <span class='hs-varid'>newFanEventWithTrigger</span> <span class='hs-varid'>f</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>lift</span> <span class='hs-varop'>$</span> <span class='hs-varid'>newFanEventWithTrigger</span> <span class='hs-varid'>f</span>
<a name="line-84"></a>
<a name="line-85"></a><a name="instance%20PerformEvent%20t%20(StaticDomBuilderT%20t%20m)"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>PerformEvent</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>PerformEvent</span> <span class='hs-varid'>t</span> <span class='hs-layout'>(</span><span class='hs-conid'>StaticDomBuilderT</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-86"></a>  <span class='hs-keyword'>type</span> <span class='hs-conid'>Performable</span> <span class='hs-layout'>(</span><span class='hs-conid'>StaticDomBuilderT</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Performable</span> <span class='hs-varid'>m</span>
<a name="line-87"></a>  <span class='hs-comment'>{-# INLINABLE performEvent_ #-}</span>
<a name="line-88"></a>  <span class='hs-varid'>performEvent_</span> <span class='hs-varid'>e</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>lift</span> <span class='hs-varop'>$</span> <span class='hs-varid'>performEvent_</span> <span class='hs-varid'>e</span>
<a name="line-89"></a>  <span class='hs-comment'>{-# INLINABLE performEvent #-}</span>
<a name="line-90"></a>  <span class='hs-varid'>performEvent</span> <span class='hs-varid'>e</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>lift</span> <span class='hs-varop'>$</span> <span class='hs-varid'>performEvent</span> <span class='hs-varid'>e</span>
<a name="line-91"></a>
<a name="line-92"></a><a name="instance%20MonadSample%20t%20(StaticDomBuilderT%20t%20m)"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>MonadSample</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>MonadSample</span> <span class='hs-varid'>t</span> <span class='hs-layout'>(</span><span class='hs-conid'>StaticDomBuilderT</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-93"></a>  <span class='hs-comment'>{-# INLINABLE sample #-}</span>
<a name="line-94"></a>  <span class='hs-varid'>sample</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>lift</span> <span class='hs-varop'>.</span> <span class='hs-varid'>sample</span>
<a name="line-95"></a>
<a name="line-96"></a><a name="instance%20MonadHold%20t%20(StaticDomBuilderT%20t%20m)"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>MonadHold</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>MonadHold</span> <span class='hs-varid'>t</span> <span class='hs-layout'>(</span><span class='hs-conid'>StaticDomBuilderT</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-97"></a>  <span class='hs-comment'>{-# INLINABLE hold #-}</span>
<a name="line-98"></a>  <span class='hs-varid'>hold</span> <span class='hs-varid'>v0</span> <span class='hs-varid'>v'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>lift</span> <span class='hs-varop'>$</span> <span class='hs-varid'>hold</span> <span class='hs-varid'>v0</span> <span class='hs-varid'>v'</span>
<a name="line-99"></a>  <span class='hs-comment'>{-# INLINABLE holdDyn #-}</span>
<a name="line-100"></a>  <span class='hs-varid'>holdDyn</span> <span class='hs-varid'>v0</span> <span class='hs-varid'>v'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>lift</span> <span class='hs-varop'>$</span> <span class='hs-varid'>holdDyn</span> <span class='hs-varid'>v0</span> <span class='hs-varid'>v'</span>
<a name="line-101"></a>  <span class='hs-comment'>{-# INLINABLE holdIncremental #-}</span>
<a name="line-102"></a>  <span class='hs-varid'>holdIncremental</span> <span class='hs-varid'>v0</span> <span class='hs-varid'>v'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>lift</span> <span class='hs-varop'>$</span> <span class='hs-varid'>holdIncremental</span> <span class='hs-varid'>v0</span> <span class='hs-varid'>v'</span>
<a name="line-103"></a>  <span class='hs-comment'>{-# INLINABLE buildDynamic #-}</span>
<a name="line-104"></a>  <span class='hs-varid'>buildDynamic</span> <span class='hs-varid'>a0</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>lift</span> <span class='hs-varop'>.</span> <span class='hs-varid'>buildDynamic</span> <span class='hs-varid'>a0</span>
<a name="line-105"></a>  <span class='hs-comment'>{-# INLINABLE headE #-}</span>
<a name="line-106"></a>  <span class='hs-varid'>headE</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>lift</span> <span class='hs-varop'>.</span> <span class='hs-varid'>headE</span>
<a name="line-107"></a>
<a name="line-108"></a><a name="instance%20TriggerEvent%20t%20(StaticDomBuilderT%20t%20m)"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>Monad</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>Ref</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>~</span> <span class='hs-conid'>Ref</span> <span class='hs-conid'>IO</span><span class='hs-layout'>,</span> <span class='hs-conid'>Reflex</span> <span class='hs-varid'>t</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>TriggerEvent</span> <span class='hs-varid'>t</span> <span class='hs-layout'>(</span><span class='hs-conid'>StaticDomBuilderT</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-109"></a>  <span class='hs-comment'>{-# INLINABLE newTriggerEvent #-}</span>
<a name="line-110"></a>  <span class='hs-varid'>newTriggerEvent</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>never</span><span class='hs-layout'>,</span> <span class='hs-varid'>const</span> <span class='hs-varop'>$</span> <span class='hs-varid'>return</span> <span class='hs-conid'>()</span><span class='hs-layout'>)</span>
<a name="line-111"></a>  <span class='hs-comment'>{-# INLINABLE newTriggerEventWithOnComplete #-}</span>
<a name="line-112"></a>  <span class='hs-varid'>newTriggerEventWithOnComplete</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>never</span><span class='hs-layout'>,</span> <span class='hs-keyglyph'>\</span><span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-conid'>()</span><span class='hs-layout'>)</span>
<a name="line-113"></a>  <span class='hs-comment'>{-# INLINABLE newEventWithLazyTriggerWithOnComplete #-}</span>
<a name="line-114"></a>  <span class='hs-varid'>newEventWithLazyTriggerWithOnComplete</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>return</span> <span class='hs-varid'>never</span>
<a name="line-115"></a>
<a name="line-116"></a><a name="instance%20MonadRef%20(StaticDomBuilderT%20t%20m)"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>MonadRef</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>MonadRef</span> <span class='hs-layout'>(</span><span class='hs-conid'>StaticDomBuilderT</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-117"></a>  <span class='hs-keyword'>type</span> <span class='hs-conid'>Ref</span> <span class='hs-layout'>(</span><span class='hs-conid'>StaticDomBuilderT</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Ref</span> <span class='hs-varid'>m</span>
<a name="line-118"></a>  <span class='hs-varid'>newRef</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>lift</span> <span class='hs-varop'>.</span> <span class='hs-varid'>newRef</span>
<a name="line-119"></a>  <span class='hs-varid'>readRef</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>lift</span> <span class='hs-varop'>.</span> <span class='hs-varid'>readRef</span>
<a name="line-120"></a>  <span class='hs-varid'>writeRef</span> <span class='hs-varid'>r</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>lift</span> <span class='hs-varop'>.</span> <span class='hs-varid'>writeRef</span> <span class='hs-varid'>r</span>
<a name="line-121"></a>
<a name="line-122"></a><a name="instance%20MonadAtomicRef%20(StaticDomBuilderT%20t%20m)"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>MonadAtomicRef</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>MonadAtomicRef</span> <span class='hs-layout'>(</span><span class='hs-conid'>StaticDomBuilderT</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-123"></a>  <span class='hs-varid'>atomicModifyRef</span> <span class='hs-varid'>r</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>lift</span> <span class='hs-varop'>.</span> <span class='hs-varid'>atomicModifyRef</span> <span class='hs-varid'>r</span>
<a name="line-124"></a>
<a name="line-125"></a><a name="SupportsStaticDomBuilder"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>SupportsStaticDomBuilder</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-conid'>Reflex</span> <span class='hs-varid'>t</span><span class='hs-layout'>,</span> <span class='hs-conid'>MonadIO</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>MonadHold</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>MonadFix</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>PerformEvent</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>MonadReflexCreateTrigger</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>MonadRef</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>Ref</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>~</span> <span class='hs-conid'>Ref</span> <span class='hs-conid'>IO</span><span class='hs-layout'>,</span> <span class='hs-conid'>Adjustable</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span>
<a name="line-126"></a>
<a name="line-127"></a><a name="StaticDomSpace"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>StaticDomSpace</span>
<a name="line-128"></a>
<a name="line-129"></a><a name="StaticDomEvent"></a><span class='hs-comment'>-- | Static documents never produce any events, so this type has no inhabitants</span>
<a name="line-130"></a><a name="StaticDomEvent"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>StaticDomEvent</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>k</span><span class='hs-layout'>)</span>
<a name="line-131"></a>
<a name="line-132"></a><a name="StaticDomHandler"></a><span class='hs-comment'>-- | Static documents don't process events, so all handlers are equivalent</span>
<a name="line-133"></a><a name="StaticDomHandler"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>StaticDomHandler</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>k</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>b</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>k</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>StaticDomHandler</span>
<a name="line-134"></a>
<a name="line-135"></a><a name="StaticEventSpec"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>StaticEventSpec</span> <span class='hs-layout'>(</span><span class='hs-varid'>er</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>EventTag</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varop'>*</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>StaticEventSpec</span> <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Generic</span><span class='hs-layout'>)</span>
<a name="line-136"></a>
<a name="line-137"></a><a name="instance%20Default%20(StaticEventSpec%20er)"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Default</span> <span class='hs-layout'>(</span><span class='hs-conid'>StaticEventSpec</span> <span class='hs-varid'>er</span><span class='hs-layout'>)</span>
<a name="line-138"></a>
<a name="line-139"></a><a name="instance%20DomSpace%20StaticDomSpace"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>DomSpace</span> <span class='hs-conid'>StaticDomSpace</span> <span class='hs-keyword'>where</span>
<a name="line-140"></a>  <span class='hs-keyword'>type</span> <span class='hs-conid'>EventSpec</span> <span class='hs-conid'>StaticDomSpace</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>StaticEventSpec</span>
<a name="line-141"></a>  <span class='hs-keyword'>type</span> <span class='hs-conid'>RawTextNode</span> <span class='hs-conid'>StaticDomSpace</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>()</span>
<a name="line-142"></a>  <span class='hs-keyword'>type</span> <span class='hs-conid'>RawElement</span> <span class='hs-conid'>StaticDomSpace</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>()</span>
<a name="line-143"></a>  <span class='hs-keyword'>type</span> <span class='hs-conid'>RawFile</span> <span class='hs-conid'>StaticDomSpace</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>()</span>
<a name="line-144"></a>  <span class='hs-keyword'>type</span> <span class='hs-conid'>RawInputElement</span> <span class='hs-conid'>StaticDomSpace</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>()</span>
<a name="line-145"></a>  <span class='hs-keyword'>type</span> <span class='hs-conid'>RawTextAreaElement</span> <span class='hs-conid'>StaticDomSpace</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>()</span>
<a name="line-146"></a>  <span class='hs-keyword'>type</span> <span class='hs-conid'>RawSelectElement</span> <span class='hs-conid'>StaticDomSpace</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>()</span>
<a name="line-147"></a>  <span class='hs-varid'>addEventSpecFlags</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>StaticEventSpec</span>
<a name="line-148"></a>
<a name="line-149"></a><a name="instance%20Adjustable%20t%20(StaticDomBuilderT%20t%20m)"></a><span class='hs-keyword'>instance</span> <span class='hs-layout'>(</span><span class='hs-conid'>Reflex</span> <span class='hs-varid'>t</span><span class='hs-layout'>,</span> <span class='hs-conid'>Adjustable</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>MonadHold</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Adjustable</span> <span class='hs-varid'>t</span> <span class='hs-layout'>(</span><span class='hs-conid'>StaticDomBuilderT</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-150"></a>  <span class='hs-varid'>runWithReplace</span> <span class='hs-varid'>a0</span> <span class='hs-varid'>a'</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-151"></a>    <span class='hs-varid'>e</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-conid'>StaticDomBuilderT</span> <span class='hs-varid'>ask</span>
<a name="line-152"></a>    <span class='hs-layout'>(</span><span class='hs-varid'>result0</span><span class='hs-layout'>,</span> <span class='hs-varid'>result'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>lift</span> <span class='hs-varop'>$</span> <span class='hs-varid'>runWithReplace</span> <span class='hs-layout'>(</span><span class='hs-varid'>runStaticDomBuilderT</span> <span class='hs-varid'>a0</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>flip</span> <span class='hs-varid'>runStaticDomBuilderT</span> <span class='hs-varid'>e</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>a'</span><span class='hs-layout'>)</span>
<a name="line-153"></a>    <span class='hs-varid'>o</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>hold</span> <span class='hs-layout'>(</span><span class='hs-varid'>snd</span> <span class='hs-varid'>result0</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-varid'>fmapCheap</span> <span class='hs-varid'>snd</span> <span class='hs-varid'>result'</span>
<a name="line-154"></a>    <span class='hs-conid'>StaticDomBuilderT</span> <span class='hs-varop'>$</span> <span class='hs-varid'>modify</span> <span class='hs-varop'>$</span> <span class='hs-layout'>(</span><span class='hs-conop'>:</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-varid'>join</span> <span class='hs-varid'>o</span>
<a name="line-155"></a>    <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>fst</span> <span class='hs-varid'>result0</span><span class='hs-layout'>,</span> <span class='hs-varid'>fmapCheap</span> <span class='hs-varid'>fst</span> <span class='hs-varid'>result'</span><span class='hs-layout'>)</span>
<a name="line-156"></a>  <span class='hs-varid'>traverseDMapWithKeyWithAdjust</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hoistDMapWithKeyWithAdjust</span> <span class='hs-varid'>traverseDMapWithKeyWithAdjust</span> <span class='hs-varid'>mapPatchDMap</span>
<a name="line-157"></a>  <span class='hs-varid'>traverseDMapWithKeyWithAdjustWithMove</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hoistDMapWithKeyWithAdjust</span> <span class='hs-varid'>traverseDMapWithKeyWithAdjustWithMove</span> <span class='hs-varid'>mapPatchDMapWithMove</span>
<a name="line-158"></a>
<a name="line-159"></a><a name="hoistDMapWithKeyWithAdjust"></a><span class='hs-definition'>hoistDMapWithKeyWithAdjust</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>forall</span> <span class='hs-layout'>(</span><span class='hs-varid'>k</span> <span class='hs-keyglyph'>::</span> <span class='hs-varop'>*</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varop'>*</span><span class='hs-layout'>)</span> <span class='hs-varid'>v</span> <span class='hs-varid'>v'</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span> <span class='hs-varid'>p</span><span class='hs-varop'>.</span>
<a name="line-160"></a>  <span class='hs-layout'>(</span> <span class='hs-conid'>Adjustable</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span>
<a name="line-161"></a>  <span class='hs-layout'>,</span> <span class='hs-conid'>MonadHold</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span>
<a name="line-162"></a>  <span class='hs-layout'>,</span> <span class='hs-conid'>PatchTarget</span> <span class='hs-layout'>(</span><span class='hs-varid'>p</span> <span class='hs-varid'>k</span> <span class='hs-layout'>(</span><span class='hs-conid'>Constant</span> <span class='hs-layout'>(</span><span class='hs-conid'>Behavior</span> <span class='hs-varid'>t</span> <span class='hs-conid'>Builder</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>~</span> <span class='hs-conid'>DMap</span> <span class='hs-varid'>k</span> <span class='hs-layout'>(</span><span class='hs-conid'>Constant</span> <span class='hs-layout'>(</span><span class='hs-conid'>Behavior</span> <span class='hs-varid'>t</span> <span class='hs-conid'>Builder</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-163"></a>  <span class='hs-layout'>,</span> <span class='hs-conid'>Patch</span> <span class='hs-layout'>(</span><span class='hs-varid'>p</span> <span class='hs-varid'>k</span> <span class='hs-layout'>(</span><span class='hs-conid'>Constant</span> <span class='hs-layout'>(</span><span class='hs-conid'>Behavior</span> <span class='hs-varid'>t</span> <span class='hs-conid'>Builder</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-164"></a>  <span class='hs-layout'>)</span>
<a name="line-165"></a>  <span class='hs-keyglyph'>=&gt;</span> <span class='hs-layout'>(</span><span class='hs-keyword'>forall</span> <span class='hs-varid'>vv</span> <span class='hs-varid'>vv'</span><span class='hs-varop'>.</span>
<a name="line-166"></a>         <span class='hs-layout'>(</span><span class='hs-keyword'>forall</span> <span class='hs-varid'>a</span><span class='hs-varop'>.</span> <span class='hs-varid'>k</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>vv</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-varid'>vv'</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-167"></a>      <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>DMap</span> <span class='hs-varid'>k</span> <span class='hs-varid'>vv</span>
<a name="line-168"></a>      <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Event</span> <span class='hs-varid'>t</span> <span class='hs-layout'>(</span><span class='hs-varid'>p</span> <span class='hs-varid'>k</span> <span class='hs-varid'>vv</span><span class='hs-layout'>)</span>
<a name="line-169"></a>      <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-conid'>DMap</span> <span class='hs-varid'>k</span> <span class='hs-varid'>vv'</span><span class='hs-layout'>,</span> <span class='hs-conid'>Event</span> <span class='hs-varid'>t</span> <span class='hs-layout'>(</span><span class='hs-varid'>p</span> <span class='hs-varid'>k</span> <span class='hs-varid'>vv'</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-170"></a>     <span class='hs-layout'>)</span> <span class='hs-comment'>-- ^ The base monad's traversal</span>
<a name="line-171"></a>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-keyword'>forall</span> <span class='hs-varid'>vv</span> <span class='hs-varid'>vv'</span><span class='hs-varop'>.</span> <span class='hs-layout'>(</span><span class='hs-keyword'>forall</span> <span class='hs-varid'>a</span><span class='hs-varop'>.</span> <span class='hs-varid'>vv</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>vv'</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>p</span> <span class='hs-varid'>k</span> <span class='hs-varid'>vv</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>p</span> <span class='hs-varid'>k</span> <span class='hs-varid'>vv'</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- ^ A way of mapping over the patch type</span>
<a name="line-172"></a>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-keyword'>forall</span> <span class='hs-varid'>a</span><span class='hs-varop'>.</span> <span class='hs-varid'>k</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>v</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>StaticDomBuilderT</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-varid'>v'</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-173"></a>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>DMap</span> <span class='hs-varid'>k</span> <span class='hs-varid'>v</span>
<a name="line-174"></a>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Event</span> <span class='hs-varid'>t</span> <span class='hs-layout'>(</span><span class='hs-varid'>p</span> <span class='hs-varid'>k</span> <span class='hs-varid'>v</span><span class='hs-layout'>)</span>
<a name="line-175"></a>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>StaticDomBuilderT</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-conid'>DMap</span> <span class='hs-varid'>k</span> <span class='hs-varid'>v'</span><span class='hs-layout'>,</span> <span class='hs-conid'>Event</span> <span class='hs-varid'>t</span> <span class='hs-layout'>(</span><span class='hs-varid'>p</span> <span class='hs-varid'>k</span> <span class='hs-varid'>v'</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-176"></a><span class='hs-definition'>hoistDMapWithKeyWithAdjust</span> <span class='hs-varid'>base</span> <span class='hs-varid'>mapPatch</span> <span class='hs-varid'>f</span> <span class='hs-varid'>dm0</span> <span class='hs-varid'>dm'</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-177"></a>  <span class='hs-varid'>e</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-conid'>StaticDomBuilderT</span> <span class='hs-varid'>ask</span>
<a name="line-178"></a>  <span class='hs-layout'>(</span><span class='hs-varid'>children0</span><span class='hs-layout'>,</span> <span class='hs-varid'>children'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>lift</span> <span class='hs-varop'>$</span> <span class='hs-varid'>base</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>k</span> <span class='hs-varid'>v</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fmap</span> <span class='hs-layout'>(</span><span class='hs-conid'>Compose</span> <span class='hs-varop'>.</span> <span class='hs-varid'>swap</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>runStaticDomBuilderT</span> <span class='hs-layout'>(</span><span class='hs-varid'>f</span> <span class='hs-varid'>k</span> <span class='hs-varid'>v</span><span class='hs-layout'>)</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varid'>dm0</span> <span class='hs-varid'>dm'</span>
<a name="line-179"></a>  <span class='hs-keyword'>let</span> <span class='hs-varid'>result0</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>DMap</span><span class='hs-varop'>.</span><span class='hs-varid'>map</span> <span class='hs-layout'>(</span><span class='hs-varid'>snd</span> <span class='hs-varop'>.</span> <span class='hs-varid'>getCompose</span><span class='hs-layout'>)</span> <span class='hs-varid'>children0</span>
<a name="line-180"></a>      <span class='hs-varid'>result'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ffor</span> <span class='hs-varid'>children'</span> <span class='hs-varop'>$</span> <span class='hs-varid'>mapPatch</span> <span class='hs-varop'>$</span> <span class='hs-varid'>snd</span> <span class='hs-varop'>.</span> <span class='hs-varid'>getCompose</span>
<a name="line-181"></a>      <span class='hs-varid'>outputs0</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>DMap</span> <span class='hs-varid'>k</span> <span class='hs-layout'>(</span><span class='hs-conid'>Constant</span> <span class='hs-layout'>(</span><span class='hs-conid'>Behavior</span> <span class='hs-varid'>t</span> <span class='hs-conid'>Builder</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-182"></a>      <span class='hs-varid'>outputs0</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>DMap</span><span class='hs-varop'>.</span><span class='hs-varid'>map</span> <span class='hs-layout'>(</span><span class='hs-conid'>Constant</span> <span class='hs-varop'>.</span> <span class='hs-varid'>fst</span> <span class='hs-varop'>.</span> <span class='hs-varid'>getCompose</span><span class='hs-layout'>)</span> <span class='hs-varid'>children0</span>
<a name="line-183"></a>      <span class='hs-varid'>outputs'</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Event</span> <span class='hs-varid'>t</span> <span class='hs-layout'>(</span><span class='hs-varid'>p</span> <span class='hs-varid'>k</span> <span class='hs-layout'>(</span><span class='hs-conid'>Constant</span> <span class='hs-layout'>(</span><span class='hs-conid'>Behavior</span> <span class='hs-varid'>t</span> <span class='hs-conid'>Builder</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-184"></a>      <span class='hs-varid'>outputs'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ffor</span> <span class='hs-varid'>children'</span> <span class='hs-varop'>$</span> <span class='hs-varid'>mapPatch</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Constant</span> <span class='hs-varop'>.</span> <span class='hs-varid'>fst</span> <span class='hs-varop'>.</span> <span class='hs-varid'>getCompose</span>
<a name="line-185"></a>  <span class='hs-varid'>outputs</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>holdIncremental</span> <span class='hs-varid'>outputs0</span> <span class='hs-varid'>outputs'</span>
<a name="line-186"></a>  <span class='hs-conid'>StaticDomBuilderT</span> <span class='hs-varop'>$</span> <span class='hs-varid'>modify</span> <span class='hs-varop'>$</span> <span class='hs-layout'>(</span><span class='hs-conop'>:</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-varid'>pull</span> <span class='hs-varop'>$</span> <span class='hs-keyword'>do</span>
<a name="line-187"></a>    <span class='hs-varid'>os</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>sample</span> <span class='hs-varop'>$</span> <span class='hs-varid'>currentIncremental</span> <span class='hs-varid'>outputs</span>
<a name="line-188"></a>    <span class='hs-varid'>fmap</span> <span class='hs-varid'>mconcat</span> <span class='hs-varop'>$</span> <span class='hs-varid'>forM</span> <span class='hs-layout'>(</span><span class='hs-conid'>DMap</span><span class='hs-varop'>.</span><span class='hs-varid'>toList</span> <span class='hs-varid'>os</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-layout'>(</span><span class='hs-keyword'>_</span> <span class='hs-conop'>:=&gt;</span> <span class='hs-conid'>Constant</span> <span class='hs-varid'>o</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span>
<a name="line-189"></a>      <span class='hs-varid'>sample</span> <span class='hs-varid'>o</span>
<a name="line-190"></a>  <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>result0</span><span class='hs-layout'>,</span> <span class='hs-varid'>result'</span><span class='hs-layout'>)</span>
<a name="line-191"></a>
<a name="line-192"></a><a name="instance%20NotReady%20t%20(StaticDomBuilderT%20t%20m)"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>SupportsStaticDomBuilder</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>NotReady</span> <span class='hs-varid'>t</span> <span class='hs-layout'>(</span><span class='hs-conid'>StaticDomBuilderT</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-193"></a>  <span class='hs-varid'>notReadyUntil</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pure</span> <span class='hs-conid'>()</span>
<a name="line-194"></a>  <span class='hs-varid'>notReady</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pure</span> <span class='hs-conid'>()</span>
<a name="line-195"></a>
<a name="line-196"></a><a name="instance%20DomBuilder%20t%20(StaticDomBuilderT%20t%20m)"></a><span class='hs-comment'>-- TODO: the uses of illegal lenses in this instance causes it to be somewhat less efficient than it can be. replacing them with explicit cases to get the underlying Maybe Event and working with those is ideal.</span>
<a name="line-197"></a><a name="instance%20DomBuilder%20t%20(StaticDomBuilderT%20t%20m)"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>SupportsStaticDomBuilder</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>DomBuilder</span> <span class='hs-varid'>t</span> <span class='hs-layout'>(</span><span class='hs-conid'>StaticDomBuilderT</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-198"></a>  <span class='hs-keyword'>type</span> <span class='hs-conid'>DomBuilderSpace</span> <span class='hs-layout'>(</span><span class='hs-conid'>StaticDomBuilderT</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>StaticDomSpace</span>
<a name="line-199"></a>  <span class='hs-comment'>{-# INLINABLE textNode #-}</span>
<a name="line-200"></a>  <span class='hs-varid'>textNode</span> <span class='hs-layout'>(</span><span class='hs-conid'>TextNodeConfig</span> <span class='hs-varid'>initialContents</span> <span class='hs-varid'>mSetContents</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>StaticDomBuilderT</span> <span class='hs-varop'>$</span> <span class='hs-keyword'>do</span>
<a name="line-201"></a>    <span class='hs-comment'>--TODO: Do not escape quotation marks; see https://stackoverflow.com/questions/25612166/what-characters-must-be-escaped-in-html-5</span>
<a name="line-202"></a>    <span class='hs-varid'>shouldEscape</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>asks</span> <span class='hs-sel'>_staticDomBuilderEnv_shouldEscape</span>
<a name="line-203"></a>    <span class='hs-keyword'>let</span> <span class='hs-varid'>escape</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>if</span> <span class='hs-varid'>shouldEscape</span> <span class='hs-keyword'>then</span> <span class='hs-varid'>fromHtmlEscapedText</span> <span class='hs-keyword'>else</span> <span class='hs-varid'>byteString</span> <span class='hs-varop'>.</span> <span class='hs-varid'>encodeUtf8</span>
<a name="line-204"></a>    <span class='hs-varid'>modify</span> <span class='hs-varop'>.</span> <span class='hs-layout'>(</span><span class='hs-conop'>:</span><span class='hs-layout'>)</span> <span class='hs-varop'>=&lt;&lt;</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>mSetContents</span> <span class='hs-keyword'>of</span>
<a name="line-205"></a>      <span class='hs-conid'>Nothing</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>pure</span> <span class='hs-layout'>(</span><span class='hs-varid'>escape</span> <span class='hs-varid'>initialContents</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-206"></a>      <span class='hs-conid'>Just</span> <span class='hs-varid'>setContents</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>hold</span> <span class='hs-layout'>(</span><span class='hs-varid'>escape</span> <span class='hs-varid'>initialContents</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-varid'>fmapCheap</span> <span class='hs-varid'>escape</span> <span class='hs-varid'>setContents</span> <span class='hs-comment'>--Only because it doesn't get optimized when profiling is on</span>
<a name="line-207"></a>    <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-conid'>TextNode</span> <span class='hs-conid'>()</span>
<a name="line-208"></a>  <span class='hs-comment'>{-# INLINABLE element #-}</span>
<a name="line-209"></a>  <span class='hs-varid'>element</span> <span class='hs-varid'>elementTag</span> <span class='hs-varid'>cfg</span> <span class='hs-varid'>child</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-210"></a>    <span class='hs-comment'>-- https://www.w3.org/TR/html-markup/syntax.html#syntax-elements</span>
<a name="line-211"></a>    <span class='hs-keyword'>let</span> <span class='hs-varid'>voidElements</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Set</span><span class='hs-varop'>.</span><span class='hs-varid'>fromList</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"area"</span><span class='hs-layout'>,</span> <span class='hs-str'>"base"</span><span class='hs-layout'>,</span> <span class='hs-str'>"br"</span><span class='hs-layout'>,</span> <span class='hs-str'>"col"</span><span class='hs-layout'>,</span> <span class='hs-str'>"command"</span><span class='hs-layout'>,</span> <span class='hs-str'>"embed"</span><span class='hs-layout'>,</span> <span class='hs-str'>"hr"</span><span class='hs-layout'>,</span> <span class='hs-str'>"img"</span><span class='hs-layout'>,</span> <span class='hs-str'>"input"</span><span class='hs-layout'>,</span> <span class='hs-str'>"keygen"</span><span class='hs-layout'>,</span> <span class='hs-str'>"link"</span><span class='hs-layout'>,</span> <span class='hs-str'>"meta"</span><span class='hs-layout'>,</span> <span class='hs-str'>"param"</span><span class='hs-layout'>,</span> <span class='hs-str'>"source"</span><span class='hs-layout'>,</span> <span class='hs-str'>"track"</span><span class='hs-layout'>,</span> <span class='hs-str'>"wbr"</span><span class='hs-keyglyph'>]</span>
<a name="line-212"></a>    <span class='hs-keyword'>let</span> <span class='hs-varid'>noEscapeElements</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Set</span><span class='hs-varop'>.</span><span class='hs-varid'>fromList</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"style"</span><span class='hs-layout'>,</span> <span class='hs-str'>"script"</span><span class='hs-keyglyph'>]</span>
<a name="line-213"></a>    <span class='hs-keyword'>let</span> <span class='hs-varid'>toAttr</span> <span class='hs-layout'>(</span><span class='hs-conid'>AttributeName</span> <span class='hs-sel'>_mns</span> <span class='hs-varid'>k</span><span class='hs-layout'>)</span> <span class='hs-varid'>v</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>byteString</span> <span class='hs-layout'>(</span><span class='hs-varid'>encodeUtf8</span> <span class='hs-varid'>k</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>byteString</span> <span class='hs-str'>"=\""</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>fromHtmlEscapedText</span> <span class='hs-varid'>v</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>byteString</span> <span class='hs-str'>"\""</span>
<a name="line-214"></a>    <span class='hs-varid'>es</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>newFanEventWithTrigger</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>return</span> <span class='hs-conid'>()</span><span class='hs-layout'>)</span>
<a name="line-215"></a>    <span class='hs-conid'>StaticDomBuilderT</span> <span class='hs-varop'>$</span> <span class='hs-keyword'>do</span>
<a name="line-216"></a>      <span class='hs-keyword'>let</span> <span class='hs-varid'>shouldEscape</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>elementTag</span> <span class='hs-varop'>`</span><span class='hs-conid'>Set</span><span class='hs-varop'>.</span><span class='hs-varid'>notMember</span><span class='hs-varop'>`</span> <span class='hs-varid'>noEscapeElements</span>
<a name="line-217"></a>      <span class='hs-layout'>(</span><span class='hs-varid'>result</span><span class='hs-layout'>,</span> <span class='hs-varid'>innerHtml</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>lift</span> <span class='hs-varop'>$</span> <span class='hs-varid'>lift</span> <span class='hs-varop'>$</span> <span class='hs-varid'>runStaticDomBuilderT</span> <span class='hs-varid'>child</span> <span class='hs-varop'>$</span> <span class='hs-conid'>StaticDomBuilderEnv</span> <span class='hs-varid'>shouldEscape</span> <span class='hs-conid'>Nothing</span>
<a name="line-218"></a>      <span class='hs-varid'>attrs0</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>foldDyn</span> <span class='hs-varid'>applyMap</span> <span class='hs-layout'>(</span><span class='hs-varid'>cfg</span> <span class='hs-varop'>^.</span> <span class='hs-varid'>initialAttributes</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>cfg</span> <span class='hs-varop'>^.</span> <span class='hs-varid'>modifyAttributes</span><span class='hs-layout'>)</span>
<a name="line-219"></a>      <span class='hs-varid'>selectValue</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>asks</span> <span class='hs-sel'>_staticDomBuilderEnv_selectValue</span>
<a name="line-220"></a>      <span class='hs-keyword'>let</span> <span class='hs-varid'>addSelectedAttr</span> <span class='hs-varid'>attrs</span> <span class='hs-varid'>sel</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-conid'>Map</span><span class='hs-varop'>.</span><span class='hs-varid'>lookup</span> <span class='hs-str'>"value"</span> <span class='hs-varid'>attrs</span> <span class='hs-keyword'>of</span>
<a name="line-221"></a>            <span class='hs-conid'>Just</span> <span class='hs-varid'>v</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>v</span> <span class='hs-varop'>==</span> <span class='hs-varid'>sel</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>attrs</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-conid'>Map</span><span class='hs-varop'>.</span><span class='hs-varid'>singleton</span> <span class='hs-str'>"selected"</span> <span class='hs-str'>""</span>
<a name="line-222"></a>            <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Map</span><span class='hs-varop'>.</span><span class='hs-varid'>delete</span> <span class='hs-str'>"selected"</span> <span class='hs-varid'>attrs</span>
<a name="line-223"></a>      <span class='hs-keyword'>let</span> <span class='hs-varid'>attrs1</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-layout'>(</span><span class='hs-varid'>elementTag</span><span class='hs-layout'>,</span> <span class='hs-varid'>selectValue</span><span class='hs-layout'>)</span> <span class='hs-keyword'>of</span>
<a name="line-224"></a>            <span class='hs-layout'>(</span><span class='hs-str'>"option"</span><span class='hs-layout'>,</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>sv</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>pull</span> <span class='hs-varop'>$</span> <span class='hs-varid'>addSelectedAttr</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>sample</span> <span class='hs-layout'>(</span><span class='hs-varid'>current</span> <span class='hs-varid'>attrs0</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;*&gt;</span> <span class='hs-varid'>sample</span> <span class='hs-varid'>sv</span>
<a name="line-225"></a>            <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>current</span> <span class='hs-varid'>attrs0</span>
<a name="line-226"></a>      <span class='hs-keyword'>let</span> <span class='hs-varid'>attrs2</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ffor</span> <span class='hs-varid'>attrs1</span> <span class='hs-varop'>$</span> <span class='hs-varid'>mconcat</span> <span class='hs-varop'>.</span> <span class='hs-varid'>fmap</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-layout'>(</span><span class='hs-varid'>k</span><span class='hs-layout'>,</span> <span class='hs-varid'>v</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-str'>" "</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>toAttr</span> <span class='hs-varid'>k</span> <span class='hs-varid'>v</span><span class='hs-layout'>)</span> <span class='hs-varop'>.</span> <span class='hs-conid'>Map</span><span class='hs-varop'>.</span><span class='hs-varid'>toList</span>
<a name="line-227"></a>      <span class='hs-keyword'>let</span> <span class='hs-varid'>tagBS</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>encodeUtf8</span> <span class='hs-varid'>elementTag</span>
<a name="line-228"></a>      <span class='hs-keyword'>if</span> <span class='hs-conid'>Set</span><span class='hs-varop'>.</span><span class='hs-varid'>member</span> <span class='hs-varid'>elementTag</span> <span class='hs-varid'>voidElements</span>
<a name="line-229"></a>        <span class='hs-keyword'>then</span> <span class='hs-varid'>modify</span> <span class='hs-varop'>$</span> <span class='hs-layout'>(</span><span class='hs-conop'>:</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-varid'>mconcat</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>constant</span> <span class='hs-layout'>(</span><span class='hs-str'>"&lt;"</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>byteString</span> <span class='hs-varid'>tagBS</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>attrs2</span><span class='hs-layout'>,</span> <span class='hs-varid'>constant</span> <span class='hs-layout'>(</span><span class='hs-varid'>byteString</span> <span class='hs-str'>" /&gt;"</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-230"></a>        <span class='hs-keyword'>else</span> <span class='hs-keyword'>do</span>
<a name="line-231"></a>          <span class='hs-keyword'>let</span> <span class='hs-varid'>open</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mconcat</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>constant</span> <span class='hs-layout'>(</span><span class='hs-str'>"&lt;"</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>byteString</span> <span class='hs-varid'>tagBS</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>attrs2</span><span class='hs-layout'>,</span> <span class='hs-varid'>constant</span> <span class='hs-layout'>(</span><span class='hs-varid'>byteString</span> <span class='hs-str'>"&gt;"</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-232"></a>          <span class='hs-keyword'>let</span> <span class='hs-varid'>close</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>constant</span> <span class='hs-varop'>$</span> <span class='hs-varid'>byteString</span> <span class='hs-varop'>$</span> <span class='hs-str'>"&lt;/"</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>tagBS</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-str'>"&gt;"</span>
<a name="line-233"></a>          <span class='hs-varid'>modify</span> <span class='hs-varop'>$</span> <span class='hs-layout'>(</span><span class='hs-conop'>:</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-varid'>mconcat</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>open</span><span class='hs-layout'>,</span> <span class='hs-varid'>innerHtml</span><span class='hs-layout'>,</span> <span class='hs-varid'>close</span><span class='hs-keyglyph'>]</span>
<a name="line-234"></a>      <span class='hs-keyword'>let</span> <span class='hs-varid'>e</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Element</span>
<a name="line-235"></a>            <span class='hs-layout'>{</span> <span class='hs-sel'>_element_events</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>es</span>
<a name="line-236"></a>            <span class='hs-layout'>,</span> <span class='hs-sel'>_element_raw</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>()</span>
<a name="line-237"></a>            <span class='hs-layout'>}</span>
<a name="line-238"></a>      <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>e</span><span class='hs-layout'>,</span> <span class='hs-varid'>result</span><span class='hs-layout'>)</span>
<a name="line-239"></a>  <span class='hs-comment'>{-# INLINABLE inputElement #-}</span>
<a name="line-240"></a>  <span class='hs-varid'>inputElement</span> <span class='hs-varid'>cfg</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-241"></a>    <span class='hs-layout'>(</span><span class='hs-varid'>e</span><span class='hs-layout'>,</span> <span class='hs-sel'>_result</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>element</span> <span class='hs-str'>"input"</span> <span class='hs-layout'>(</span><span class='hs-varid'>cfg</span> <span class='hs-varop'>^.</span> <span class='hs-varid'>inputElementConfig_elementConfig</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-varid'>return</span> <span class='hs-conid'>()</span>
<a name="line-242"></a>    <span class='hs-keyword'>let</span> <span class='hs-varid'>v0</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>constDyn</span> <span class='hs-varop'>$</span> <span class='hs-varid'>cfg</span> <span class='hs-varop'>^.</span> <span class='hs-varid'>inputElementConfig_initialValue</span>
<a name="line-243"></a>    <span class='hs-keyword'>let</span> <span class='hs-varid'>c0</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>constDyn</span> <span class='hs-varop'>$</span> <span class='hs-varid'>cfg</span> <span class='hs-varop'>^.</span> <span class='hs-varid'>inputElementConfig_initialChecked</span>
<a name="line-244"></a>    <span class='hs-keyword'>let</span> <span class='hs-varid'>hasFocus</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>constDyn</span> <span class='hs-conid'>False</span> <span class='hs-comment'>-- TODO should this be coming from initialAtttributes</span>
<a name="line-245"></a>    <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-conid'>InputElement</span>
<a name="line-246"></a>      <span class='hs-layout'>{</span> <span class='hs-sel'>_inputElement_value</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>v0</span>
<a name="line-247"></a>      <span class='hs-layout'>,</span> <span class='hs-sel'>_inputElement_checked</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>c0</span>
<a name="line-248"></a>      <span class='hs-layout'>,</span> <span class='hs-sel'>_inputElement_checkedChange</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>never</span>
<a name="line-249"></a>      <span class='hs-layout'>,</span> <span class='hs-sel'>_inputElement_input</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>never</span>
<a name="line-250"></a>      <span class='hs-layout'>,</span> <span class='hs-sel'>_inputElement_hasFocus</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hasFocus</span>
<a name="line-251"></a>      <span class='hs-layout'>,</span> <span class='hs-sel'>_inputElement_element</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>e</span>
<a name="line-252"></a>      <span class='hs-layout'>,</span> <span class='hs-sel'>_inputElement_raw</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>()</span>
<a name="line-253"></a>      <span class='hs-layout'>,</span> <span class='hs-sel'>_inputElement_files</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>constDyn</span> <span class='hs-varid'>mempty</span>
<a name="line-254"></a>      <span class='hs-layout'>}</span>
<a name="line-255"></a>  <span class='hs-comment'>{-# INLINABLE textAreaElement #-}</span>
<a name="line-256"></a>  <span class='hs-varid'>textAreaElement</span> <span class='hs-varid'>cfg</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-257"></a>    <span class='hs-comment'>--TODO: Support setValue event</span>
<a name="line-258"></a>    <span class='hs-layout'>(</span><span class='hs-varid'>e</span><span class='hs-layout'>,</span> <span class='hs-sel'>_domElement</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>element</span> <span class='hs-str'>"textarea"</span> <span class='hs-layout'>(</span><span class='hs-varid'>cfg</span> <span class='hs-varop'>^.</span> <span class='hs-varid'>textAreaElementConfig_elementConfig</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-varid'>return</span> <span class='hs-conid'>()</span>
<a name="line-259"></a>    <span class='hs-keyword'>let</span> <span class='hs-varid'>v0</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>constDyn</span> <span class='hs-varop'>$</span> <span class='hs-varid'>cfg</span> <span class='hs-varop'>^.</span> <span class='hs-varid'>textAreaElementConfig_initialValue</span>
<a name="line-260"></a>    <span class='hs-keyword'>let</span> <span class='hs-varid'>hasFocus</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>constDyn</span> <span class='hs-conid'>False</span> <span class='hs-comment'>-- TODO should this be coming from initialAtttributes</span>
<a name="line-261"></a>    <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-conid'>TextAreaElement</span>
<a name="line-262"></a>      <span class='hs-layout'>{</span> <span class='hs-sel'>_textAreaElement_value</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>v0</span>
<a name="line-263"></a>      <span class='hs-layout'>,</span> <span class='hs-sel'>_textAreaElement_input</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>never</span>
<a name="line-264"></a>      <span class='hs-layout'>,</span> <span class='hs-sel'>_textAreaElement_hasFocus</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hasFocus</span>
<a name="line-265"></a>      <span class='hs-layout'>,</span> <span class='hs-sel'>_textAreaElement_element</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>e</span>
<a name="line-266"></a>      <span class='hs-layout'>,</span> <span class='hs-sel'>_textAreaElement_raw</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>()</span>
<a name="line-267"></a>      <span class='hs-layout'>}</span>
<a name="line-268"></a>  <span class='hs-varid'>selectElement</span> <span class='hs-varid'>cfg</span> <span class='hs-varid'>child</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-269"></a>    <span class='hs-varid'>v</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>holdDyn</span> <span class='hs-layout'>(</span><span class='hs-varid'>cfg</span> <span class='hs-varop'>^.</span> <span class='hs-varid'>selectElementConfig_initialValue</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>cfg</span> <span class='hs-varop'>^.</span> <span class='hs-varid'>selectElementConfig_setValue</span><span class='hs-layout'>)</span>
<a name="line-270"></a>    <span class='hs-layout'>(</span><span class='hs-varid'>e</span><span class='hs-layout'>,</span> <span class='hs-varid'>result</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>element</span> <span class='hs-str'>"select"</span> <span class='hs-layout'>(</span><span class='hs-sel'>_selectElementConfig_elementConfig</span> <span class='hs-varid'>cfg</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-keyword'>do</span>
<a name="line-271"></a>      <span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-varid'>innerHtml</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-conid'>StaticDomBuilderT</span> <span class='hs-varop'>$</span> <span class='hs-varid'>lift</span> <span class='hs-varop'>$</span> <span class='hs-varid'>lift</span> <span class='hs-varop'>$</span> <span class='hs-varid'>runStaticDomBuilderT</span> <span class='hs-varid'>child</span> <span class='hs-varop'>$</span> <span class='hs-conid'>StaticDomBuilderEnv</span> <span class='hs-conid'>False</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Just</span> <span class='hs-layout'>(</span><span class='hs-varid'>current</span> <span class='hs-varid'>v</span><span class='hs-layout'>)</span>
<a name="line-272"></a>      <span class='hs-conid'>StaticDomBuilderT</span> <span class='hs-varop'>$</span> <span class='hs-varid'>lift</span> <span class='hs-varop'>$</span> <span class='hs-varid'>modify</span> <span class='hs-varop'>$</span> <span class='hs-layout'>(</span><span class='hs-conop'>:</span><span class='hs-layout'>)</span> <span class='hs-varid'>innerHtml</span>
<a name="line-273"></a>      <span class='hs-varid'>return</span> <span class='hs-varid'>a</span>
<a name="line-274"></a>    <span class='hs-keyword'>let</span> <span class='hs-varid'>wrapped</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>SelectElement</span>
<a name="line-275"></a>          <span class='hs-layout'>{</span> <span class='hs-sel'>_selectElement_value</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>v</span>
<a name="line-276"></a>          <span class='hs-layout'>,</span> <span class='hs-sel'>_selectElement_change</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>never</span>
<a name="line-277"></a>          <span class='hs-layout'>,</span> <span class='hs-sel'>_selectElement_hasFocus</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>constDyn</span> <span class='hs-conid'>False</span> <span class='hs-comment'>--TODO: How do we make sure this is correct?</span>
<a name="line-278"></a>          <span class='hs-layout'>,</span> <span class='hs-sel'>_selectElement_element</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>e</span>
<a name="line-279"></a>          <span class='hs-layout'>,</span> <span class='hs-sel'>_selectElement_raw</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>()</span>
<a name="line-280"></a>          <span class='hs-layout'>}</span>
<a name="line-281"></a>    <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>wrapped</span><span class='hs-layout'>,</span> <span class='hs-varid'>result</span><span class='hs-layout'>)</span>
<a name="line-282"></a>  <span class='hs-varid'>placeRawElement</span> <span class='hs-conid'>()</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>return</span> <span class='hs-conid'>()</span>
<a name="line-283"></a>  <span class='hs-varid'>wrapRawElement</span> <span class='hs-conid'>()</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Element</span> <span class='hs-layout'>(</span><span class='hs-conid'>EventSelector</span> <span class='hs-varop'>$</span> <span class='hs-varid'>const</span> <span class='hs-varid'>never</span><span class='hs-layout'>)</span> <span class='hs-conid'>()</span>
<a name="line-284"></a>
<a name="line-285"></a><a name="StaticWidget"></a><span class='hs-comment'>--TODO: Make this more abstract --TODO: Put the WithWebView underneath PerformEventT - I think this would perform better</span>
<a name="line-286"></a><a name="StaticWidget"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>StaticWidget</span> <span class='hs-varid'>x</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>PostBuildT</span> <span class='hs-conid'>Spider</span> <span class='hs-layout'>(</span><span class='hs-conid'>StaticDomBuilderT</span> <span class='hs-conid'>Spider</span> <span class='hs-layout'>(</span><span class='hs-conid'>PerformEventT</span> <span class='hs-conid'>Spider</span> <span class='hs-layout'>(</span><span class='hs-conid'>SpiderHost</span> <span class='hs-conid'>Global</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-287"></a>
<a name="line-288"></a><a name="renderStatic"></a><span class='hs-comment'>{-# INLINE renderStatic #-}</span>
<a name="line-289"></a><span class='hs-definition'>renderStatic</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>StaticWidget</span> <span class='hs-varid'>x</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-layout'>(</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-conid'>ByteString</span><span class='hs-layout'>)</span>
<a name="line-290"></a><span class='hs-definition'>renderStatic</span> <span class='hs-varid'>w</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-291"></a>  <span class='hs-varid'>runSpiderHost</span> <span class='hs-varop'>$</span> <span class='hs-keyword'>do</span>
<a name="line-292"></a>    <span class='hs-layout'>(</span><span class='hs-varid'>postBuild</span><span class='hs-layout'>,</span> <span class='hs-varid'>postBuildTriggerRef</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>newEventWithTriggerRef</span>
<a name="line-293"></a>    <span class='hs-keyword'>let</span> <span class='hs-varid'>env0</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>StaticDomBuilderEnv</span> <span class='hs-conid'>True</span> <span class='hs-conid'>Nothing</span>
<a name="line-294"></a>    <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-varid'>res</span><span class='hs-layout'>,</span> <span class='hs-varid'>bs</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>FireCommand</span> <span class='hs-varid'>fire</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>hostPerformEventT</span> <span class='hs-varop'>$</span> <span class='hs-varid'>runStaticDomBuilderT</span> <span class='hs-layout'>(</span><span class='hs-varid'>runPostBuildT</span> <span class='hs-varid'>w</span> <span class='hs-varid'>postBuild</span><span class='hs-layout'>)</span> <span class='hs-varid'>env0</span>
<a name="line-295"></a>    <span class='hs-varid'>mPostBuildTrigger</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>readRef</span> <span class='hs-varid'>postBuildTriggerRef</span>
<a name="line-296"></a>    <span class='hs-varid'>forM_</span> <span class='hs-varid'>mPostBuildTrigger</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>postBuildTrigger</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>fire</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>postBuildTrigger</span> <span class='hs-conop'>:=&gt;</span> <span class='hs-conid'>Identity</span> <span class='hs-conid'>()</span><span class='hs-keyglyph'>]</span> <span class='hs-varop'>$</span> <span class='hs-varid'>return</span> <span class='hs-conid'>()</span>
<a name="line-297"></a>    <span class='hs-varid'>bs'</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>sample</span> <span class='hs-varid'>bs</span>
<a name="line-298"></a>    <span class='hs-varid'>return</span> <span class='hs-layout'>(</span><span class='hs-varid'>res</span><span class='hs-layout'>,</span> <span class='hs-conid'>LBS</span><span class='hs-varop'>.</span><span class='hs-varid'>toStrict</span> <span class='hs-varop'>$</span> <span class='hs-varid'>toLazyByteString</span> <span class='hs-varid'>bs'</span><span class='hs-layout'>)</span>
</pre></body>
</html>
