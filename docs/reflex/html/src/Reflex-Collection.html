<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>src/Reflex/Collection.hs</title>
<link type='text/css' rel='stylesheet' href='hscolour.css' />
</head>
<body>
<pre><a name="line-1"></a><span class='hs-comment'>{-# LANGUAGE CPP #-}</span>
<a name="line-2"></a><span class='hs-comment'>{-# LANGUAGE RankNTypes #-}</span>
<a name="line-3"></a><span class='hs-comment'>{-# LANGUAGE LambdaCase #-}</span>
<a name="line-4"></a><span class='hs-comment'>{-# LANGUAGE RecursiveDo #-}</span>
<a name="line-5"></a><span class='hs-comment'>{-# LANGUAGE ScopedTypeVariables #-}</span>
<a name="line-6"></a><span class='hs-comment'>{-# LANGUAGE MultiParamTypeClasses #-}</span>
<a name="line-7"></a><span class='hs-comment'>{-# LANGUAGE FunctionalDependencies #-}</span>
<a name="line-8"></a><span class='hs-comment'>{-# LANGUAGE FlexibleInstances #-}</span>
<a name="line-9"></a><span class='hs-comment'>{-# LANGUAGE TypeFamilies #-}</span>
<a name="line-10"></a><span class='hs-comment'>{-# LANGUAGE UndecidableInstances #-}</span>
<a name="line-11"></a><span class='hs-cpp'>#ifdef USE_REFLEX_OPTIMIZER</span>
<a name="line-12"></a><span class='hs-comment'>{-# OPTIONS_GHC -fplugin=Reflex.Optimizer #-}</span>
<a name="line-13"></a><span class='hs-cpp'>#endif</span>
<a name="line-14"></a><span class='hs-keyword'>module</span> <span class='hs-conid'>Reflex</span><span class='hs-varop'>.</span><span class='hs-conid'>Collection</span>
<a name="line-15"></a>  <span class='hs-layout'>(</span> 
<a name="line-16"></a>  <span class='hs-comment'>-- * Widgets on Collections</span>
<a name="line-17"></a>    <span class='hs-varid'>listHoldWithKey</span>
<a name="line-18"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>listWithKey</span>
<a name="line-19"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>listWithKey'</span>
<a name="line-20"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>listWithKeyShallowDiff</span>
<a name="line-21"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>listViewWithKey</span>
<a name="line-22"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>selectViewListWithKey</span>
<a name="line-23"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>selectViewListWithKey_</span>
<a name="line-24"></a>  <span class='hs-comment'>-- * List Utils</span>
<a name="line-25"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>list</span>
<a name="line-26"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>simpleList</span>
<a name="line-27"></a>  <span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-28"></a>
<a name="line-29"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Control</span><span class='hs-varop'>.</span><span class='hs-conid'>Monad</span><span class='hs-varop'>.</span><span class='hs-conid'>Identity</span> <span class='hs-varid'>hiding</span> <span class='hs-layout'>(</span><span class='hs-varid'>forM</span><span class='hs-layout'>,</span> <span class='hs-varid'>forM_</span><span class='hs-layout'>,</span> <span class='hs-varid'>mapM</span><span class='hs-layout'>,</span> <span class='hs-varid'>mapM_</span><span class='hs-layout'>,</span> <span class='hs-varid'>sequence</span><span class='hs-layout'>,</span> <span class='hs-varid'>sequence_</span><span class='hs-layout'>)</span>
<a name="line-30"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Align</span>
<a name="line-31"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Map</span> <span class='hs-layout'>(</span><span class='hs-conid'>Map</span><span class='hs-layout'>)</span>
<a name="line-32"></a><span class='hs-keyword'>import</span> <span class='hs-keyword'>qualified</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Map</span> <span class='hs-keyword'>as</span> <span class='hs-conid'>Map</span>
<a name="line-33"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Functor</span><span class='hs-varop'>.</span><span class='hs-conid'>Misc</span>
<a name="line-34"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Map</span><span class='hs-varop'>.</span><span class='hs-conid'>Misc</span>
<a name="line-35"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>These</span>
<a name="line-36"></a>
<a name="line-37"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Reflex</span><span class='hs-varop'>.</span><span class='hs-conid'>Class</span>
<a name="line-38"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Reflex</span><span class='hs-varop'>.</span><span class='hs-conid'>Dynamic</span>
<a name="line-39"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Reflex</span><span class='hs-varop'>.</span><span class='hs-conid'>PostBuild</span><span class='hs-varop'>.</span><span class='hs-conid'>Class</span>
<a name="line-40"></a>
<a name="line-41"></a><a name="listHoldWithKey"></a><span class='hs-definition'>listHoldWithKey</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span> <span class='hs-varid'>k</span> <span class='hs-varid'>v</span> <span class='hs-varid'>a</span><span class='hs-varop'>.</span> <span class='hs-layout'>(</span><span class='hs-conid'>Ord</span> <span class='hs-varid'>k</span><span class='hs-layout'>,</span> <span class='hs-conid'>Adjustable</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>MonadHold</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-varid'>v</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Event</span> <span class='hs-varid'>t</span> <span class='hs-layout'>(</span><span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-varid'>v</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>k</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>v</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-conid'>Dynamic</span> <span class='hs-varid'>t</span> <span class='hs-layout'>(</span><span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-42"></a><span class='hs-definition'>listHoldWithKey</span> <span class='hs-varid'>m0</span> <span class='hs-varid'>m'</span> <span class='hs-varid'>f</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-43"></a>  <span class='hs-keyword'>let</span> <span class='hs-varid'>dm0</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mapWithFunctorToDMap</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Map</span><span class='hs-varop'>.</span><span class='hs-varid'>mapWithKey</span> <span class='hs-varid'>f</span> <span class='hs-varid'>m0</span>
<a name="line-44"></a>      <span class='hs-varid'>dm'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fmap</span> <span class='hs-layout'>(</span><span class='hs-conid'>PatchDMap</span> <span class='hs-varop'>.</span> <span class='hs-varid'>mapWithFunctorToDMap</span> <span class='hs-varop'>.</span> <span class='hs-conid'>Map</span><span class='hs-varop'>.</span><span class='hs-varid'>mapWithKey</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>k</span> <span class='hs-varid'>v</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ComposeMaybe</span> <span class='hs-varop'>$</span> <span class='hs-varid'>fmap</span> <span class='hs-layout'>(</span><span class='hs-varid'>f</span> <span class='hs-varid'>k</span><span class='hs-layout'>)</span> <span class='hs-varid'>v</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varid'>m'</span>
<a name="line-45"></a>  <span class='hs-layout'>(</span><span class='hs-varid'>a0</span><span class='hs-layout'>,</span> <span class='hs-varid'>a'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>sequenceDMapWithAdjust</span> <span class='hs-varid'>dm0</span> <span class='hs-varid'>dm'</span>
<a name="line-46"></a>  <span class='hs-varid'>fmap</span> <span class='hs-varid'>dmapToMap</span> <span class='hs-varop'>.</span> <span class='hs-varid'>incrementalToDynamic</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>holdIncremental</span> <span class='hs-varid'>a0</span> <span class='hs-varid'>a'</span> <span class='hs-comment'>--TODO: Move the dmapToMap to the righthand side so it doesn't get fully redone every time</span>
<a name="line-47"></a>
<a name="line-48"></a><a name="listWithKey"></a><span class='hs-comment'>--TODO: Something better than Dynamic t (Map k v) - we want something where the Events carry diffs, not the whole value</span>
<a name="line-49"></a><span class='hs-definition'>listWithKey</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>t</span> <span class='hs-varid'>k</span> <span class='hs-varid'>v</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span><span class='hs-varop'>.</span> <span class='hs-layout'>(</span><span class='hs-conid'>Ord</span> <span class='hs-varid'>k</span><span class='hs-layout'>,</span> <span class='hs-conid'>Adjustable</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>PostBuild</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>MonadFix</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>MonadHold</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Dynamic</span> <span class='hs-varid'>t</span> <span class='hs-layout'>(</span><span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-varid'>v</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>k</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Dynamic</span> <span class='hs-varid'>t</span> <span class='hs-varid'>v</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-conid'>Dynamic</span> <span class='hs-varid'>t</span> <span class='hs-layout'>(</span><span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-50"></a><span class='hs-definition'>listWithKey</span> <span class='hs-varid'>vals</span> <span class='hs-varid'>mkChild</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-51"></a>  <span class='hs-varid'>postBuild</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getPostBuild</span>
<a name="line-52"></a>  <span class='hs-keyword'>let</span> <span class='hs-varid'>childValChangedSelector</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fanMap</span> <span class='hs-varop'>$</span> <span class='hs-varid'>updated</span> <span class='hs-varid'>vals</span>
<a name="line-53"></a>      <span class='hs-comment'>-- We keep track of changes to children values in the mkChild function we pass to listHoldWithKey</span>
<a name="line-54"></a>      <span class='hs-comment'>-- The other changes we need to keep track of are child insertions and deletions. diffOnlyKeyChanges</span>
<a name="line-55"></a>      <span class='hs-comment'>-- keeps track of insertions and deletions but ignores value changes, since they're already accounted for.</span>
<a name="line-56"></a>      <span class='hs-varid'>diffOnlyKeyChanges</span> <span class='hs-varid'>olds</span> <span class='hs-varid'>news</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>flip</span> <span class='hs-conid'>Map</span><span class='hs-varop'>.</span><span class='hs-varid'>mapMaybe</span> <span class='hs-layout'>(</span><span class='hs-varid'>align</span> <span class='hs-varid'>olds</span> <span class='hs-varid'>news</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-keyword'>case</span>
<a name="line-57"></a>        <span class='hs-conid'>This</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Just</span> <span class='hs-conid'>Nothing</span>
<a name="line-58"></a>        <span class='hs-conid'>These</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Nothing</span>
<a name="line-59"></a>        <span class='hs-conid'>That</span> <span class='hs-varid'>new</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Just</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>new</span>
<a name="line-60"></a>  <span class='hs-varid'>rec</span> <span class='hs-varid'>sentVals</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Dynamic</span> <span class='hs-varid'>t</span> <span class='hs-layout'>(</span><span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-varid'>v</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>foldDyn</span> <span class='hs-varid'>applyMap</span> <span class='hs-conid'>Map</span><span class='hs-varop'>.</span><span class='hs-varid'>empty</span> <span class='hs-varid'>changeVals</span>
<a name="line-61"></a>      <span class='hs-keyword'>let</span> <span class='hs-varid'>changeVals</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Event</span> <span class='hs-varid'>t</span> <span class='hs-layout'>(</span><span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-varid'>v</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-62"></a>          <span class='hs-varid'>changeVals</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>attachWith</span> <span class='hs-varid'>diffOnlyKeyChanges</span> <span class='hs-layout'>(</span><span class='hs-varid'>current</span> <span class='hs-varid'>sentVals</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-varid'>leftmost</span>
<a name="line-63"></a>                         <span class='hs-keyglyph'>[</span> <span class='hs-varid'>updated</span> <span class='hs-varid'>vals</span>
<a name="line-64"></a>                         <span class='hs-layout'>,</span> <span class='hs-varid'>tag</span> <span class='hs-layout'>(</span><span class='hs-varid'>current</span> <span class='hs-varid'>vals</span><span class='hs-layout'>)</span> <span class='hs-varid'>postBuild</span> <span class='hs-comment'>--TODO: This should probably be added to the attachWith, not to the updated; if we were using diffMap instead of diffMapNoEq, I think it might not work</span>
<a name="line-65"></a>                         <span class='hs-keyglyph'>]</span>
<a name="line-66"></a>  <span class='hs-varid'>listHoldWithKey</span> <span class='hs-conid'>Map</span><span class='hs-varop'>.</span><span class='hs-varid'>empty</span> <span class='hs-varid'>changeVals</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>k</span> <span class='hs-varid'>v</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-67"></a>    <span class='hs-varid'>mkChild</span> <span class='hs-varid'>k</span> <span class='hs-varop'>=&lt;&lt;</span> <span class='hs-varid'>holdDyn</span> <span class='hs-varid'>v</span> <span class='hs-layout'>(</span><span class='hs-varid'>select</span> <span class='hs-varid'>childValChangedSelector</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Const2</span> <span class='hs-varid'>k</span><span class='hs-layout'>)</span>
<a name="line-68"></a>
<a name="line-69"></a><a name="listWithKey'"></a><span class='hs-comment'>{-# DEPRECATED listWithKey' "listWithKey' has been renamed to listWithKeyShallowDiff; also, its behavior has changed to fix a bug where children were always rebuilt (never updated)" #-}</span>
<a name="line-70"></a><span class='hs-definition'>listWithKey'</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Ord</span> <span class='hs-varid'>k</span><span class='hs-layout'>,</span> <span class='hs-conid'>Adjustable</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>MonadFix</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>MonadHold</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-varid'>v</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Event</span> <span class='hs-varid'>t</span> <span class='hs-layout'>(</span><span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-varid'>v</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>k</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>v</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Event</span> <span class='hs-varid'>t</span> <span class='hs-varid'>v</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-conid'>Dynamic</span> <span class='hs-varid'>t</span> <span class='hs-layout'>(</span><span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-71"></a><span class='hs-definition'>listWithKey'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>listWithKeyShallowDiff</span>
<a name="line-72"></a>
<a name="line-73"></a><a name="listWithKeyShallowDiff"></a><span class='hs-comment'>-- | Display the given map of items (in key order) using the builder function provided, and update it with the given event.  'Nothing' update entries will delete the corresponding children, and 'Just' entries will create them if they do not exist or send an update event to them if they do.</span>
<a name="line-74"></a><span class='hs-definition'>listWithKeyShallowDiff</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Ord</span> <span class='hs-varid'>k</span><span class='hs-layout'>,</span> <span class='hs-conid'>Adjustable</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>MonadFix</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>MonadHold</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-varid'>v</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Event</span> <span class='hs-varid'>t</span> <span class='hs-layout'>(</span><span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-varid'>v</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>k</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>v</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Event</span> <span class='hs-varid'>t</span> <span class='hs-varid'>v</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-conid'>Dynamic</span> <span class='hs-varid'>t</span> <span class='hs-layout'>(</span><span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-75"></a><span class='hs-definition'>listWithKeyShallowDiff</span> <span class='hs-varid'>initialVals</span> <span class='hs-varid'>valsChanged</span> <span class='hs-varid'>mkChild</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-76"></a>  <span class='hs-keyword'>let</span> <span class='hs-varid'>childValChangedSelector</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fanMap</span> <span class='hs-varop'>$</span> <span class='hs-varid'>fmap</span> <span class='hs-layout'>(</span><span class='hs-conid'>Map</span><span class='hs-varop'>.</span><span class='hs-varid'>mapMaybe</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span> <span class='hs-varid'>valsChanged</span>
<a name="line-77"></a>  <span class='hs-varid'>sentVals</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>foldDyn</span> <span class='hs-varid'>applyMap</span> <span class='hs-layout'>(</span><span class='hs-varid'>void</span> <span class='hs-varid'>initialVals</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-varid'>fmap</span> <span class='hs-layout'>(</span><span class='hs-varid'>fmap</span> <span class='hs-varid'>void</span><span class='hs-layout'>)</span> <span class='hs-varid'>valsChanged</span>
<a name="line-78"></a>  <span class='hs-keyword'>let</span> <span class='hs-varid'>relevantPatch</span> <span class='hs-varid'>patch</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>patch</span> <span class='hs-keyword'>of</span>
<a name="line-79"></a>        <span class='hs-conid'>Nothing</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Just</span> <span class='hs-conid'>Nothing</span> <span class='hs-comment'>-- Even if we let a Nothing through when the element doesn't already exist, this doesn't cause a problem because it is ignored</span>
<a name="line-80"></a>        <span class='hs-conid'>Just</span> <span class='hs-keyword'>_</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Nothing</span> <span class='hs-comment'>-- We don't want to let spurious re-creations of items through</span>
<a name="line-81"></a>  <span class='hs-varid'>listHoldWithKey</span> <span class='hs-varid'>initialVals</span> <span class='hs-layout'>(</span><span class='hs-varid'>attachWith</span> <span class='hs-layout'>(</span><span class='hs-varid'>flip</span> <span class='hs-layout'>(</span><span class='hs-conid'>Map</span><span class='hs-varop'>.</span><span class='hs-varid'>differenceWith</span> <span class='hs-varid'>relevantPatch</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>current</span> <span class='hs-varid'>sentVals</span><span class='hs-layout'>)</span> <span class='hs-varid'>valsChanged</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>k</span> <span class='hs-varid'>v</span> <span class='hs-keyglyph'>-&gt;</span>
<a name="line-82"></a>    <span class='hs-varid'>mkChild</span> <span class='hs-varid'>k</span> <span class='hs-varid'>v</span> <span class='hs-varop'>$</span> <span class='hs-varid'>select</span> <span class='hs-varid'>childValChangedSelector</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Const2</span> <span class='hs-varid'>k</span>
<a name="line-83"></a>
<a name="line-84"></a><a name="listViewWithKey"></a><span class='hs-comment'>--TODO: Something better than Dynamic t (Map k v) - we want something where the Events carry diffs, not the whole value</span>
<a name="line-85"></a><span class='hs-comment'>-- | Create a dynamically-changing set of Event-valued widgets.</span>
<a name="line-86"></a><span class='hs-comment'>--   This is like listWithKey, specialized for widgets returning (Event t a).  listWithKey would return 'Dynamic t (Map k (Event t a))' in this scenario, but listViewWithKey flattens this to 'Event t (Map k a)' via 'switch'.</span>
<a name="line-87"></a><span class='hs-definition'>listViewWithKey</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Ord</span> <span class='hs-varid'>k</span><span class='hs-layout'>,</span> <span class='hs-conid'>Adjustable</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>PostBuild</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>MonadHold</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>MonadFix</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Dynamic</span> <span class='hs-varid'>t</span> <span class='hs-layout'>(</span><span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-varid'>v</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>k</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Dynamic</span> <span class='hs-varid'>t</span> <span class='hs-varid'>v</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-conid'>Event</span> <span class='hs-varid'>t</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-conid'>Event</span> <span class='hs-varid'>t</span> <span class='hs-layout'>(</span><span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-88"></a><span class='hs-definition'>listViewWithKey</span> <span class='hs-varid'>vals</span> <span class='hs-varid'>mkChild</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>switch</span> <span class='hs-varop'>.</span> <span class='hs-varid'>fmap</span> <span class='hs-varid'>mergeMap</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>listViewWithKey'</span> <span class='hs-varid'>vals</span> <span class='hs-varid'>mkChild</span>
<a name="line-89"></a>
<a name="line-90"></a><a name="listViewWithKey'"></a><span class='hs-definition'>listViewWithKey'</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Ord</span> <span class='hs-varid'>k</span><span class='hs-layout'>,</span> <span class='hs-conid'>Adjustable</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>PostBuild</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>MonadHold</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>MonadFix</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Dynamic</span> <span class='hs-varid'>t</span> <span class='hs-layout'>(</span><span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-varid'>v</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>k</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Dynamic</span> <span class='hs-varid'>t</span> <span class='hs-varid'>v</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-conid'>Behavior</span> <span class='hs-varid'>t</span> <span class='hs-layout'>(</span><span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-91"></a><span class='hs-definition'>listViewWithKey'</span> <span class='hs-varid'>vals</span> <span class='hs-varid'>mkChild</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>current</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>listWithKey</span> <span class='hs-varid'>vals</span> <span class='hs-varid'>mkChild</span>
<a name="line-92"></a>
<a name="line-93"></a><a name="selectViewListWithKey"></a><span class='hs-comment'>-- | Create a dynamically-changing set of widgets, one of which is selected at any time.</span>
<a name="line-94"></a><span class='hs-definition'>selectViewListWithKey</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span> <span class='hs-varid'>k</span> <span class='hs-varid'>v</span> <span class='hs-varid'>a</span><span class='hs-varop'>.</span> <span class='hs-layout'>(</span><span class='hs-conid'>Adjustable</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>Ord</span> <span class='hs-varid'>k</span><span class='hs-layout'>,</span> <span class='hs-conid'>PostBuild</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>MonadHold</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>MonadFix</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span>
<a name="line-95"></a>  <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Dynamic</span> <span class='hs-varid'>t</span> <span class='hs-varid'>k</span>          <span class='hs-comment'>-- ^ Current selection key</span>
<a name="line-96"></a>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Dynamic</span> <span class='hs-varid'>t</span> <span class='hs-layout'>(</span><span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-varid'>v</span><span class='hs-layout'>)</span>  <span class='hs-comment'>-- ^ Dynamic key/value map</span>
<a name="line-97"></a>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>k</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Dynamic</span> <span class='hs-varid'>t</span> <span class='hs-varid'>v</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Dynamic</span> <span class='hs-varid'>t</span> <span class='hs-conid'>Bool</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-conid'>Event</span> <span class='hs-varid'>t</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- ^ Function to create a widget for a given key from Dynamic value and Dynamic Bool indicating if this widget is currently selected</span>
<a name="line-98"></a>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-conid'>Event</span> <span class='hs-varid'>t</span> <span class='hs-layout'>(</span><span class='hs-varid'>k</span><span class='hs-layout'>,</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>        <span class='hs-comment'>-- ^ Event that fires when any child's return Event fires.  Contains key of an arbitrary firing widget.</span>
<a name="line-99"></a><span class='hs-definition'>selectViewListWithKey</span> <span class='hs-varid'>selection</span> <span class='hs-varid'>vals</span> <span class='hs-varid'>mkChild</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-100"></a>  <span class='hs-keyword'>let</span> <span class='hs-varid'>selectionDemux</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>demux</span> <span class='hs-varid'>selection</span> <span class='hs-comment'>-- For good performance, this value must be shared across all children</span>
<a name="line-101"></a>  <span class='hs-varid'>selectChild</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>listWithKey</span> <span class='hs-varid'>vals</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>k</span> <span class='hs-varid'>v</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span>
<a name="line-102"></a>    <span class='hs-keyword'>let</span> <span class='hs-varid'>selected</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>demuxed</span> <span class='hs-varid'>selectionDemux</span> <span class='hs-varid'>k</span>
<a name="line-103"></a>    <span class='hs-varid'>selectSelf</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>mkChild</span> <span class='hs-varid'>k</span> <span class='hs-varid'>v</span> <span class='hs-varid'>selected</span>
<a name="line-104"></a>    <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-varid'>fmap</span> <span class='hs-layout'>(</span><span class='hs-conid'>(,)</span> <span class='hs-varid'>k</span><span class='hs-layout'>)</span> <span class='hs-varid'>selectSelf</span>
<a name="line-105"></a>  <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-varid'>switchPromptlyDyn</span> <span class='hs-varop'>$</span> <span class='hs-varid'>leftmost</span> <span class='hs-varop'>.</span> <span class='hs-conid'>Map</span><span class='hs-varop'>.</span><span class='hs-varid'>elems</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>selectChild</span>
<a name="line-106"></a>
<a name="line-107"></a><a name="selectViewListWithKey_"></a><span class='hs-definition'>selectViewListWithKey_</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>forall</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span> <span class='hs-varid'>k</span> <span class='hs-varid'>v</span> <span class='hs-varid'>a</span><span class='hs-varop'>.</span> <span class='hs-layout'>(</span><span class='hs-conid'>Adjustable</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>Ord</span> <span class='hs-varid'>k</span><span class='hs-layout'>,</span> <span class='hs-conid'>PostBuild</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>MonadHold</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>MonadFix</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span>
<a name="line-108"></a>  <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Dynamic</span> <span class='hs-varid'>t</span> <span class='hs-varid'>k</span>          <span class='hs-comment'>-- ^ Current selection key</span>
<a name="line-109"></a>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Dynamic</span> <span class='hs-varid'>t</span> <span class='hs-layout'>(</span><span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-varid'>v</span><span class='hs-layout'>)</span>  <span class='hs-comment'>-- ^ Dynamic key/value map</span>
<a name="line-110"></a>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-varid'>k</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Dynamic</span> <span class='hs-varid'>t</span> <span class='hs-varid'>v</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Dynamic</span> <span class='hs-varid'>t</span> <span class='hs-conid'>Bool</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-conid'>Event</span> <span class='hs-varid'>t</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- ^ Function to create a widget for a given key from Dynamic value and Dynamic Bool indicating if this widget is currently selected</span>
<a name="line-111"></a>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-conid'>Event</span> <span class='hs-varid'>t</span> <span class='hs-varid'>k</span><span class='hs-layout'>)</span>        <span class='hs-comment'>-- ^ Event that fires when any child's return Event fires.  Contains key of an arbitrary firing widget.</span>
<a name="line-112"></a><span class='hs-definition'>selectViewListWithKey_</span> <span class='hs-varid'>selection</span> <span class='hs-varid'>vals</span> <span class='hs-varid'>mkChild</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fmap</span> <span class='hs-varid'>fst</span> <span class='hs-varop'>&lt;$&gt;</span> <span class='hs-varid'>selectViewListWithKey</span> <span class='hs-varid'>selection</span> <span class='hs-varid'>vals</span> <span class='hs-varid'>mkChild</span>
<a name="line-113"></a>
<a name="line-114"></a><a name="list"></a><span class='hs-comment'>-- | Create a dynamically-changing set of widgets from a Dynamic key/value map.</span>
<a name="line-115"></a><span class='hs-comment'>--   Unlike the 'withKey' variants, the child widgets are insensitive to which key they're associated with.</span>
<a name="line-116"></a><span class='hs-definition'>list</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Ord</span> <span class='hs-varid'>k</span><span class='hs-layout'>,</span> <span class='hs-conid'>Adjustable</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>MonadHold</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>PostBuild</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>MonadFix</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Dynamic</span> <span class='hs-varid'>t</span> <span class='hs-layout'>(</span><span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-varid'>v</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>Dynamic</span> <span class='hs-varid'>t</span> <span class='hs-varid'>v</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-conid'>Dynamic</span> <span class='hs-varid'>t</span> <span class='hs-layout'>(</span><span class='hs-conid'>Map</span> <span class='hs-varid'>k</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-117"></a><span class='hs-definition'>list</span> <span class='hs-varid'>dm</span> <span class='hs-varid'>mkChild</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>listWithKey</span> <span class='hs-varid'>dm</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-keyword'>_</span> <span class='hs-varid'>dv</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>mkChild</span> <span class='hs-varid'>dv</span><span class='hs-layout'>)</span>
<a name="line-118"></a>
<a name="line-119"></a><a name="simpleList"></a><span class='hs-comment'>-- | Create a dynamically-changing set of widgets from a Dynamic list.</span>
<a name="line-120"></a><span class='hs-definition'>simpleList</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Adjustable</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>MonadHold</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>PostBuild</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span><span class='hs-layout'>,</span> <span class='hs-conid'>MonadFix</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Dynamic</span> <span class='hs-varid'>t</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>v</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>Dynamic</span> <span class='hs-varid'>t</span> <span class='hs-varid'>v</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-layout'>(</span><span class='hs-conid'>Dynamic</span> <span class='hs-varid'>t</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>a</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span>
<a name="line-121"></a><span class='hs-definition'>simpleList</span> <span class='hs-varid'>xs</span> <span class='hs-varid'>mkChild</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fmap</span> <span class='hs-layout'>(</span><span class='hs-varid'>fmap</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-varid'>snd</span> <span class='hs-varop'>.</span> <span class='hs-conid'>Map</span><span class='hs-varop'>.</span><span class='hs-varid'>toList</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-varid'>flip</span> <span class='hs-varid'>list</span> <span class='hs-varid'>mkChild</span> <span class='hs-varop'>$</span> <span class='hs-varid'>fmap</span> <span class='hs-layout'>(</span><span class='hs-conid'>Map</span><span class='hs-varop'>.</span><span class='hs-varid'>fromList</span> <span class='hs-varop'>.</span> <span class='hs-varid'>zip</span> <span class='hs-keyglyph'>[</span><span class='hs-layout'>(</span><span class='hs-num'>1</span><span class='hs-keyglyph'>::</span><span class='hs-conid'>Int</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>..</span><span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-varid'>xs</span>
</pre></body>
</html>
